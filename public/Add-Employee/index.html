<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LT Add Employee</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
</head>
<!------------------------- NAVEGATION BAR --------------------------->
<div class="nav-bar-container">
    <nav class="nav-bar">
        <div class="nav-logo">
            <h1>LaborTrack</h1>
        </div>
        <ul class="nav-links">
            <li><a href="/Main/index.html">Home</a></li>
            <li><a href="#" id="logoutLink">Logout</a></li>
        </ul>
    </nav>
</div>
<!--======================== MAIN CONTENT ========================-->
 <div class="main-content">
     <!------------------------- LEFT PANEL ------------------------>
    <div class="left-panel-container">
        <!-- EMPTY -->
    </div>
    <!------------------------- MIDDLE PANEL ------------------------------>
    <div class="middle-panel-container">
        <div class="add-employee-form">
            <h2>Add Employee</h2>
            <form id="employeeForm" enctype="multipart/form-data">
                <!-- Profile Image -->
                <div class="image-upload">
                    <label for="profilePic">
                      <div class="image-circle">
                        <img id="preview-image" src="Images/default-user.png" alt="Profile Image">
                      </div>
                    </label>
                    <input id="profilePic" type="file" accept="image/*">
                </div>
                <!-- Name -->
                <div class="input-group">
                    <label for="name">Name</label>
                    <input id="name" type="text" placeholder="Name" required>
                </div>
                <!-- Datebirth -->
                <div class="input-group">
                    <label>Date of Birth</label>
                    <input id="dateBirth" type="date" required>
                </div>
                <!-- Job Details -->
                <div class="input-group">
                    <label>Job Details</label>
                    <input id="position" type="text" placeholder="Position" required>
                    <input id="department" type="text" placeholder="Department" required>
                    <input id="hourlyWage" type="number" step="0.01" placeholder="Hourly Wage ($)" required>
                </div>
                <!-- Contact Information -->
                <div class="input-group">
                    <label>Contact Information</label>
                    <input id="email" type="email" placeholder="Email" required>
                    <input id="phoneNumber" type="text" id="" placeholder="Phone Number" required>
                    <input id="address" type="text" id="" placeholder="Address, City, State, Zip" required>
                </div>
                <!-- Button -->
                <div class="form-button">
                    <button class="submit-button" type="submit">Submit</button>
                </div>
            </form>
        </div>
    </div>
    <!--------------------------- RIGHT PANEL ---------------------------------->
    <div class="right-panel-container">
        <!-- EMPTY -->
    </div>
 </div>

 <!----------------------- JAVASCRIPT --------------------->
 <script>
    (function(){
      const form = document.getElementById('employeeForm');

      // preview logic stays the same…
      const picInput = document.getElementById('profilePic');
      const preview  = document.getElementById('preview-image');
      picInput.addEventListener('change', () => {
        if (picInput.files && picInput.files[0]) {
          preview.src = URL.createObjectURL(picInput.files[0]);
        } else {
          preview.src = 'Images/default-user.png';
        }
      });

      form.addEventListener('submit', onSubmit);

      async function onSubmit(e) {
        e.preventDefault();

        // 1️⃣ collect all the fields
        const name        = document.getElementById('name').value;
        const [year, month, day] = document
          .getElementById('dateBirth')
          .value.split('-').map(Number);

        const position    = document.getElementById('position').value;
        const department  = document.getElementById('department').value;
        const hourlyWage  = parseFloat(document.getElementById('hourlyWage').value);

        const email       = document.getElementById('email').value;
        const phoneNumber = document.getElementById('phoneNumber').value;
        const address     = document.getElementById('address').value;

        // 2️⃣ profilePic filename only (we’re not uploading the binary here)
        const profilePic = picInput.files && picInput.files[0]
          ? picInput.files[0].name
          : 'default.jpg';

        // 3️⃣ build the flat payload matching Employee.class
        const employee = {
          name,
          day,
          month,
          year,
          profilePic,
          jobDetails:   { position, department, hourlyWage },
          contactInfo: { email, phoneNumber, address }
        };

        // 4️⃣ POST to the session-backed endpoint
        try {
          const res = await fetch('/api/employees', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify(employee)
          });

          // parse any JSON error
          if (!res.ok) {
            const err = await res.json();
            throw new Error(err.error || res.statusText);
          }

          // 5️⃣ success → go home
          alert('Employee added successfully!');
          window.location.href = '/Main/index.html';
        } catch (err) {
          console.error(err);
          alert('Failed to add employee: ' + err.message);
        }
      }
    })();
  </script>
</body>

</html>